{% extends 'base.html' %}
{% block title %}Create Student{% endblock %}
{% block scripts %}
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const passcode = "{{ passcode }}";

                //const storedStudentID = localStorage.getItem(passcode);

                //if (storedStudentID) {
                    //window.location.href = `/${passcode}/${storedStudentID}`;
                //}

                document.getElementById('create-student-form').onsubmit = function() {
                    event.preventDefault();
                    
                    const name = document.getElementById('create-student-name').value;
                    const contact = document.getElementById('create-student-contact').value;

                    const newStudent = {
                        displayName: name,
                        contactDetails: contact,
                    }

                    fetch(`/api/${passcode}/create_student`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(newStudent)
                    })
                    .then(response => response.json())
                    .then(data => {
                        const student_id = data["student_id"];
                        localStorage.setItem(passcode, student_id);
                        window.location.href = `/${passcode}/${student_id}`;
                    });
                }
            })
        </script>
{% endblock %}
{% block content %}
    <content class="d-flex justify-content-center align-items-center flex-grow-1" style="margin-top: -3%;">
        <div class="text-center"> 
            <h5> How do you want to be displayed as? </h5>
            <form class="form" method="post" id="create-student-form">
                <input class="form-control my-2" id="create-student-name" type="text" placeholder="Display Name" required>
                <input class="form-control my-2" id="create-student-contact" type="text" placeholder="Contact Details" required>
            <button class="btn btn-outline-success w-100" id="create-student-submit" type="submit"> Join </button>
            </form>
        </div>
    </content>
{% endblock %}